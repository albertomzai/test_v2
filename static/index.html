<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <title>Lista de Tareas</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 2rem; }
        #task-form { display: flex; gap: 0.5rem; margin-bottom: 1rem; }
        #tasks-list { list-style: none; padding: 0; }
        .task-item { display: flex; justify-content: space-between; align-items: center; padding: 0.5rem;
                      border: 1px solid #ccc; margin-bottom: 0.25rem; }
        button { cursor: pointer; background-color: #e74c3c; color: white; border: none; padding: 0.2rem 0.4rem; }
    </style>
</head>
<body>
    <h1>Lista de Tareas</h1>
    <form id="task-form">
        <input type="text" id="new-task" placeholder="Nueva tarea" required />
        <button type="submit">Añadir</button>
    </form>
    <ul id="tasks-list"></ul>

    <script>
        // Constantes de almacenamiento local y API
        const LOCAL_STORAGE_KEY = 'todo_tasks';
        const API_ENDPOINT = '/api/tareas';

        /**
         * Carga las tareas desde el localStorage.
         * @returns {Array<string>} Lista de tareas.
         */
        function cargar_tareas() {
            const stored = localStorage.getItem(LOCAL_STORAGE_KEY);
            return stored ? JSON.parse(stored) : [];
        }

        /**
         * Guarda las tareas en el localStorage.
         * @param {Array<string>} tasks Lista de tareas a guardar.
         */
        function guardar_tareas(tasks) {
            localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(tasks));
        }

        /**
         * Renderiza la lista completa en el DOM.
         * @param {Array<string>} tasks Lista de tareas.
         */
        function renderizar_tareas(tasks) {
            const list = document.getElementById('tasks-list');
            list.innerHTML = '';
            tasks.forEach((task, index) => {
                const li = document.createElement('li');
                li.className = 'task-item';
                li.textContent = task;

                const btn = document.createElement('button');
                btn.textContent = 'Eliminar';
                btn.onclick = () => eliminar_tarea(index);

                li.appendChild(btn);
                list.appendChild(li);
            });
        }

        /**
         * Envía una petición al backend para añadir o eliminar una tarea.
         * @param {string} action 'add' o 'remove'
         * @param {Object} data Datos de la tarea.
         */
        function enviar_api(action, data) {
            fetch(API_ENDPOINT, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ action, ...data })
            }).catch(err => console.error('Error al comunicar con la API:', err));
        }

        /**
         * Añade una nueva tarea.
         * @param {string} task Texto de la tarea.
         */
        function agregar_tarea(task) {
            const tasks = cargar_tareas();
            tasks.push(task);
            guardar_tareas(tasks);
            renderizar_tareas(tasks);
            enviar_api('add', { task });
        }

        /**
         * Elimina una tarea por índice.
         * @param {number} index Índice de la tarea a eliminar.
         */
        function eliminar_tarea(index) {
            const tasks = cargar_tareas();
            const removed = tasks.splice(index, 1)[0];
            guardar_tareas(tasks);
            renderizar_tareas(tasks);
            enviar_api('remove', { task: removed });
        }

        // Inicialización
        document.addEventListener('DOMContentLoaded', () => {
            const initialTasks = cargar_tareas();
            renderizar_tareas(initialTasks);

            const form = document.getElementById('task-form');
            form.addEventListener('submit', e => {
                e.preventDefault();
                const input = document.getElementById('new-task');
                const taskText = input.value.trim();
                if (taskText) {
                    agregar_tarea(taskText);
                    input.value = '';
                }
            });
        });
    </script>
</body>
</html>