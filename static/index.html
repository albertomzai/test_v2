<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Simulador de Hipotecas</title>
    <style>
        body {font-family: Arial, sans-serif; margin: 20px; background:#f9f9f9;}
        h1 {text-align:center; color:#333;}
        form {max-width:400px; margin:auto; padding:20px; background:white; border-radius:8px; box-shadow:0 2px 5px rgba(0,0,0,.1);}
        label {display:block; margin-top:10px; font-weight:bold;}
        input[type=number] {width:100%; padding:8px; margin-top:5px; border:1px solid #ccc; border-radius:4px;}
        button {margin-top:15px; width:100%; padding:10px; background:#007bff; color:white; border:none; border-radius:4px; cursor:pointer; font-size:16px;}
        button:hover {background:#0056b3;}
        table {width:100%; margin-top:20px; border-collapse:collapse;}
        th, td {border:1px solid #ddd; padding:8px; text-align:right;}
        th {background:#007bff; color:white;}
        @media (max-width:600px){form{padding:15px;}button{font-size:14px;}}
    </style>
</head>
<body>
    <h1>Simulador de Hipotecas</h1>
    <form id="mortgage-form">
        <label for="principal">Importe del préstamo (€)</label>
        <input type="number" id="principal" name="principal" step="0.01" min="0" required>

        <label for="annual_rate">Tasa de interés anual (%)</label>
        <input type="number" id="annual_rate" name="annual_rate" step="0.01" min="0" required>

        <label for="years">Plazo (años)</label>
        <input type="number" id="years" name="years" step="1" min="1" required>

        <button type="submit">Generar tabla</button>
    </form>
    <div id="amortization-table"></div>

    <script>
        const form = document.getElementById('mortgage-form');
        const tableDiv = document.getElementById('amortization-table');

        /**
         * Calcula la tabla de amortización para un préstamo con pagos fijos.
         * @param {number} principal - Importe del préstamo.
         * @param {number} annual_rate - Tasa anual en porcentaje.
         * @param {number} years - Plazo en años.
         * @returns {Array<Object>} Tabla con cada pago mensual.
         */
        function calculate_amortization(principal, annual_rate, years) {
            const monthly_rate = annual_rate / 100 / 12;
            const months = years * 12;
            const payment = principal * (monthly_rate * Math.pow(1 + monthly_rate, months)) /
                            (Math.pow(1 + monthly_rate, months) - 1);

            let balance = principal;
            const table = [];

            for (let i = 1; i <= months; i++) {
                const interest = balance * monthly_rate;
                const principal_payment = payment - interest;
                balance -= principal_payment;
                if (balance < 0) balance = 0;

                table.push({
                    month: i,
                    payment: payment.toFixed(2),
                    principal: principal_payment.toFixed(2),
                    interest: interest.toFixed(2),
                    balance: balance.toFixed(2)
                });
            }
            return table;
        }

        /**
         * Renderiza la tabla de amortización en el DOM.
         * @param {Array<Object>} data - Datos de la tabla.
         */
        function render_table(data) {
            if (!data.length) return;
            let html = '<table><thead><tr>' +
                        ['Mes', 'Pago', 'Principal', 'Interés', 'Saldo'].map(col => `<th>${col}</th>`).join('') +
                        '</tr></thead><tbody>';
            data.forEach(row => {
                html += '<tr>' +
                        Object.values(row).map(val => `<td>${val}</td>`).join('') +
                        '</tr>';
            });
            html += '</tbody></table>';
            tableDiv.innerHTML = html;
        }

        form.addEventListener('submit', function(e) {
            e.preventDefault();
            const principal = parseFloat(document.getElementById('principal').value);
            const annual_rate = parseFloat(document.getElementById('annual_rate').value);
            const years = parseInt(document.getElementById('years').value, 10);

            if (isNaN(principal) || isNaN(annual_rate) || isNaN(years)) {
                alert('Por favor ingrese valores válidos.');
                return;
            }

            const table = calculate_amortization(principal, annual_rate, years);
            render_table(table);
        });
    </script>
</body>
</html>