<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Simulador de Hipotecas</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 2rem; }
        form { display: flex; flex-direction: column; max-width: 400px; }
        label { margin-top: 1rem; }
        input[type="number"] { padding: 0.5rem; font-size: 1rem; }
        button { margin-top: 1.5rem; padding: 0.75rem; font-size: 1rem; cursor: pointer; }
        table { width: 100%; border-collapse: collapse; margin-top: 2rem; }
        th, td { border: 1px solid #ccc; padding: 0.5rem; text-align: right; }
        th { background-color: #f4f4f4; }
    </style>
</head>
<body>
    <h1>Simulador de Hipotecas</h1>
    <form id="amortizacionForm">
        <label for="importe">Importe del préstamo:</label>
        <input type="number" id="importe" name="importe" required min="0" step="0.01">

        <label for="tasa_interes">Tasa de interés (% anual):</label>
        <input type="number" id="tasa_interes" name="tasa_interes" required min="0" step="0.01">

        <label for="plazo">Plazo (meses):</label>
        <input type="number" id="plazo" name="plazo" required min="1" step="1">

        <button type="submit">Calcular amortización</button>
    </form>

    <table id="tablaAmortizacion" style="display:none;">
        <thead>
            <tr>
                <th>Pago #</th>
                <th>Interés</th>
                <th>Principal</th>
                <th>Saldo Restante</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script type="module">
        const API_ENDPOINT = '/calcularAmortizacion';

        /**
         * Envía los parámetros del formulario al backend y actualiza la tabla.
         * @param {Event} event Evento de envío del formulario.
         */
        async function manejar_formulario(event) {
            event.preventDefault();
            const importe = parseFloat(document.getElementById('importe').value);
            const tasa_interes = parseFloat(document.getElementById('tasa_interes').value);
            const plazo = parseInt(document.getElementById('plazo').value, 10);

            try {
                const response = await fetch(API_ENDPOINT, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ importe, tasa_interes, plazo })
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`Error del servidor: ${errorText}`);
                }

                const data = await response.json();
                mostrar_tabla(data.tabla_amortizacion);
            } catch (err) {
                console.error(err);
                alert('Hubo un error al calcular la amortización.');
            }
        }

        /**
         * Renderiza la tabla de amortización en el DOM.
         * @param {Array<Object>} tabla Array con los pagos.
         */
        function mostrar_tabla(tabla) {
            const tbody = document.querySelector('#tablaAmortizacion tbody');
            tbody.innerHTML = '';

            tabla.forEach((pago, index) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${pago.interes.toFixed(2)}</td>
                    <td>${pago.principal.toFixed(2)}</td>
                    <td>${pago.saldo_restante.toFixed(2)}</td>
                `;
                tbody.appendChild(tr);
            });

            document.getElementById('tablaAmortizacion').style.display = 'table';
        }

        document.getElementById('amortizacionForm').addEventListener('submit', manejar_formulario);
    </script>
</body>
</html>